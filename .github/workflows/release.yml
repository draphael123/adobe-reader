# Create GitHub Release when a tag is pushed
name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: windows-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller
      
      - name: Build executable
        run: |
          pyinstaller PDFScreenshotTool.spec
      
      - name: Create ZIP
        run: |
          Compress-Archive -Path dist\PDFScreenshotTool.exe -DestinationPath PDFScreenshotTool.zip
      
      - name: Generate checksums
        run: |
          $exeHash = (Get-FileHash dist\PDFScreenshotTool.exe -Algorithm SHA256).Hash
          $zipHash = (Get-FileHash PDFScreenshotTool.zip -Algorithm SHA256).Hash
          @"
          # PDF Screenshot Tool ${{ github.ref_name }} - Checksums
          
          ## PDFScreenshotTool.exe
          SHA-256: $exeHash
          
          ## PDFScreenshotTool.zip  
          SHA-256: $zipHash
          "@ | Out-File -FilePath CHECKSUMS.md -Encoding UTF8
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/PDFScreenshotTool.exe
            PDFScreenshotTool.zip
            CHECKSUMS.md
          body: |
            ## PDF Screenshot Tool ${{ github.ref_name }}
            
            ### Downloads
            - **PDFScreenshotTool.exe** - Standalone executable
            - **PDFScreenshotTool.zip** - Portable version
            
            ### Verification
            See CHECKSUMS.md for SHA-256 hashes to verify your download.
            
            ### Windows SmartScreen Note
            If Windows shows a warning, click "More info" â†’ "Run anyway". This is normal for independent developer software.
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

